<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Training Daily Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>üèãÔ∏è Training Tracker</h1>
                <p>Sign in to manage exercises</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="message message-error hidden"></div>

            <!-- Login Form -->
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        required 
                        autocomplete="username"
                        placeholder="Enter your username"
                    >
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        autocomplete="current-password"
                        placeholder="Enter your password"
                    >
                </div>

                <button type="submit" class="btn btn-primary" id="loginBtn" style="width: 100%;">
                    <span id="loginBtnText">Sign In</span>
                    <span id="loginBtnLoading" class="loading hidden"></span>
                </button>
            </form>

            <div class="back-link">
                <a href="index.html">‚Üê Back to Home</a>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // DOM Elements
        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const loginBtnText = document.getElementById('loginBtnText');
        const loginBtnLoading = document.getElementById('loginBtnLoading');
        const errorMessageEl = document.getElementById('errorMessage');

        /**
         * Check if already authenticated
         */
        function checkAuth() {
            if (isAuthenticated()) {
                window.location.href = 'admin.html';
            }
        }

        /**
         * Handle login form submission
         */
        async function handleLogin(e) {
            e.preventDefault();

            // Get form values
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            // Validate inputs
            if (!username || !password) {
                showError('Please enter both username and password');
                return;
            }

            // Show loading state
            setLoading(true);
            hideError();

            try {
                // Call login API
                const token = await login(username, password);

                // Save token
                saveToken(token);

                // Show success and redirect
                showSuccess('Login successful! Redirecting...');
                
                setTimeout(() => {
                    window.location.href = 'admin.html';
                }, 1000);

            } catch (error) {
                showError('Invalid username or password. Please try again.');
                console.error('Login error:', error);
            } finally {
                setLoading(false);
            }
        }

        /**
         * Set loading state
         */
        function setLoading(isLoading) {
            if (isLoading) {
                loginBtn.disabled = true;
                loginBtnText.classList.add('hidden');
                loginBtnLoading.classList.remove('hidden');
            } else {
                loginBtn.disabled = false;
                loginBtnText.classList.remove('hidden');
                loginBtnLoading.classList.add('hidden');
            }
        }

        /**
         * Show error message
         */
        function showError(message) {
            errorMessageEl.textContent = message;
            errorMessageEl.classList.remove('hidden');
        }

        /**
         * Hide error message
         */
        function hideError() {
            errorMessageEl.classList.add('hidden');
        }

        /**
         * Show success message
         */
        function showSuccess(message) {
            // Convert error div to success
            errorMessageEl.className = 'message message-success';
            errorMessageEl.textContent = message;
            errorMessageEl.classList.remove('hidden');
        }

        // Event listeners
        loginForm.addEventListener('submit', handleLogin);

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>
